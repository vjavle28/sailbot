---
import Layout from "../../components/Layout.astro";
import { supabase } from "../../utils/database";

export const prerender = false;

const { id } = Astro.params;

if (!id) {
  throw new Error("No sensor id provided");
}

// Fetch sensor data from Supabase if connection is set up
let sensor;
if (supabase) {
  const { data, error } = await supabase
    .from("sailboat_sensor_data")
    .select("*")
    .eq("id", Number(id))
    .single();
  sensor = data ? data : null;
  if (error || !sensor) {
    console.error(error);
    throw new Error("No sensor data found");
  }
}
---

<Layout title={`Sensor ${sensor?.id} | Sailboat`}>
  <article class="border-b pb-14 border-neutral-600">
    <header class="pb-2 mb-8 border-b">
      <h1 class="mb-4 text-3xl font-bold">Sensor reading {sensor?.id}</h1>
      <p class="font-mono">{new Date(sensor?.timestamp).toLocaleString()}</p>
    </header>

    {sensor?.photo_url && (
      <figure>
        <img src={sensor.photo_url} alt={`photo ${sensor.id}`} class="mb-4 border rounded-sm border-neutral-500" />
      </figure>
    )}

    <dl class="grid grid-cols-2 gap-4 text-lg">
      <div>
        <dt class="font-mono">Latitude</dt>
        <dd>{sensor?.latitude}</dd>
      </div>
      <div>
        <dt class="font-mono">Longitude</dt>
        <dd>{sensor?.longitude}</dd>
      </div>
      <div>
        <dt class="font-mono">Wind Speed</dt>
        <dd>{sensor?.wind_speed ?? "—"}</dd>
      </div>
      <div>
        <dt class="font-mono">Wind Direction</dt>
        <dd>{sensor?.wind_direction ?? "—"}</dd>
      </div>
      <div>
        <dt class="font-mono">Boat Speed</dt>
        <dd>{sensor?.boat_speed ?? "—"}</dd>
      </div>
      <div>
        <dt class="font-mono">Heading</dt>
        <dd>{sensor?.heading ?? "—"}</dd>
      </div>
      <div>
        <dt class="font-mono">Battery Level</dt>
        <dd>{sensor?.battery_level ?? "—"}</dd>
      </div>
    </dl>
  </article>
</Layout>
